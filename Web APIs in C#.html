<!-- TODO: Finish paragraphs -->

<h1>Making Web APIs in C#</h1>

<h2>What Is a Web API?</h2>
<p>
    Firstly, an API (Application Programming Interface) is just software that 
    allows two other programs to communicate with each other. Thus, a *Web* API 
    is a program that allows two apps to share data over the internet. These apps 
    may be the front and back ends of a website, but can really run anywhere on the internet.
</p>

<h2>Why Use a Web API? Why Not MVC or Another Architecture?</h2>
<p>
    There are many design patterns, each with their own pros and cons, but the 
    beauty of a Web API is that it cleanly separates the front and back ends of 
    a full-stack web app, such that either could easily be scrapped and replaced 
    with totally different software written in a different language without having 
    to change the other. For example, this blog has a C# + SQL Server back end 
    and a vanilla JavaScript + vanilla CSS front end. The entire front end could 
    be re-built with a C# Blazor WAsm app, and the server-side code would require 
    zero changes. Alternatively, this blog's back end could be used by a mobile 
    app (written perhaps in Swift or Kotlin), or by a desktop program (like a C# 
    WinForms app or a Flutter project), or by all of the above at once.
</p>

<h2>How to Program a Web API in C#</h2>
<p>
    First, let's open Visual Studio, select Create a new Project and then find the ASP.NET Core Web API project template. If you're using 
    an older version of Visual Studio, you'll need to select the ASP.NET Core Web Application project template, 
    and then select the Web API project template after naming the project.
</p>
<img src="https://andreblog.azurewebsites.net/images/CreateNewWebAPI.png" alt="Selecting the C# Web API template">
<p>
    Click 'Next' and give the new project a descriptive name (like FirstWebAPIProject) 
    and choose the folder where you want it to be. Click 'Next' and observe that VS 
    automatically selects the most recent version of .NET you have installed. Leave 
    all of the default values for this example and click 'Create' to generate the new project. 
    If you'
</p>
<p style="margin-bottom: 1px;">
    Once the code generator has finished scaffolding out the new Web API project, observe 
    in the Solution Explorer tab the codebase structure. The Program.cs file contains the 
    code for running the Web API. If you're using .NET 5.0 or an earlier .NET Core version, 
    the code for configuring startup the API is found in the Startup.cs file. This is where 
    you would write code to define authentication and authorization 
    policies or add different services to dependency injection. The appsettings.json file 
    stores additional configuration data.
</p>
<p>
    The more interesting code is in the WeatherForecast.cs and Controllers/WeatherForecastController.cs 
    files. The WeatherForecast data model expectedly has a few properties for storing data about what 
    the weather was at a specific time:    
</p>
<code>public class WeatherForecast
{
    public DateTime Date { get; set; }

    public int TemperatureC { get; set; }

    public int TemperatureF => 32 + (int)(TemperatureC / 0.5556);

    public string Summary { get; set; }
}
</code>
<p>
    In the WeatherForecastController we see a single RESTful API controller with an
    endpoint that returns a list of randomly filled out WeatherForecasts:
</p>
<code>[ApiController]
    [Route("[controller]")]
    public class WeatherForecastController : ControllerBase
    {
        private static readonly string[] Summaries = new[]
        {
        "Freezing", "Bracing", "Chilly", "Cool", "Mild", "Warm", "Balmy", "Hot", "Sweltering", "Scorching"
    };

        private readonly ILogger&lt;WeatherForecastController&gt; _logger;

        public WeatherForecastController(ILogger&lt;WeatherForecastController&gt; logger)
        {
            _logger = logger;
        }

        [HttpGet]
        public IEnumerable&lt;WeatherForecast&gt; Get()
        {
            return Enumerable.Range(1, 5).Select(index => new WeatherForecast
            {
                Date = DateTime.Now.AddDays(index),
                TemperatureC = Random.Shared.Next(-20, 55),
                Summary = Summaries[Random.Shared.Next(Summaries.Length)]
            })
            .ToArray();
        }
    }
</code>

<h2>How to Consume the C# Web API with JavaScript</h2>
<!-- <p>
    - Creating a wwwroot folder
    - html page + a little CSS
    - JavaScript fetch API
    - Looking at the finished project
</p> -->
<p style="margin-bottom: 1px;">
    If you run the template project, you'll notice that it opens the Swagger UI, which 
    lets you call the API. However, the Swagger UI is not a production-ready front-end. 
    Let's add a simple front-end to the project to call the API. We could use a JavaScript 
    framework like React, Vue, or Angular and add a CSS framework like Bootstrap or TailwindCSS, 
    but we'll use vanilla JavaScript and CSS for now.
</p>
<p>
    First, we'll create a folder called wwwroot in the project root (the wwwroot folder is used in
    C# web projects to contain front-end specific files). This is where we'll put our JavaScript and 
    CSS files. We'll also create a file called index.html in this folder. Web browsers will look for 
    index.html to load the page when we visit the site. Add the following code to the index.html file:
</p>
<code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"/&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"/&gt;
    &lt;title&gt;Weather Forecast&lt;/title&gt;
    &lt;link rel="stylesheet" href="css/site.css"&gt;
    &lt;script src="js/site.js defer"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;main id="main"&gt;
        &lt;h1&gt;Weather Forecast&lt;/h1&gt;
        &lt;h2&gt;Five-day Forecast:&lt;/h2&gt;
        &lt;!-- JavaScript code will insert forecast data here --&gt;
    &lt;/main&gt;
&lt;/body&gt;
&lt;/html&gt;</code>
<p>
    Next, create a folder named css in the wwwroot folder. This is where we'll 
    add a new CSS file called site.css. Add the following code to the site.css file:
</p>
<code>*, *:before, *:after {
    box-sizing: border-box;
}
body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    font-family: "Segoe UI", "Ubuntu", sans-serif;
}
main {
    width: 100%;
    min-height: 100%;
    text-align: center;    
}
h1 {
    font-size: 3rem;
    font-weight: 400;
    margin-top: 5rem;
    margin-bottom: 1rem;
}
h2 {
    font-size: 2rem;
    font-weight: 400;
    margin-bottom: 1rem;
}
p {
    padding: 0.5rem 0;
    border-top: 1px solid #ccc;
}
</code>
<p>
    Finally, create a js folder in the wwwroot folder and add the following JavaScript file to it:
</p>
<code>let apiResponse = await fetch('/weatherForecast')
let forecasts = await apiResponse.json()

forecasts.forEach(forecast => {
    let p = document.createElement('p')
    p.innerText = `${forecast.dateFormatted} - ${forecast.temperatureC}C/${forecast.temperatureF}F - ${forecast.summary}`
    document.getElementById('main').appendChild(p)
})
</code>
<p>
    The JavaScript code uses the fetch API to call our C# weather forecast API and then uses the
    json method to parse the response. It then iterates through the forecasts and adds a paragraph 
    to the main element for each forecast. If you run the project now, you'll see the following:
</p>
<img src="images/weatherForecastFinished.png" alt="Weather Forecast project, finished" />


<p style="margin-top: 2rem; font-size: 1.0625rem;">
    In this tutorial, we learned what a C# web API is, how to create one, add a front-end to it, and consume the 
    API with JavaScript. See if you can make your applications better by using a web API!
</p>

<!-- Tags: C#,JavaScript,HTTP -->
